<!doctype html>  
<html lang="en">
	
	<head>
		<meta charset="utf-8">
		
		<title>What to expect when you are expecting</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		
		<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
		
		<link rel="stylesheet" href="css/main.css">
		<link rel="stylesheet" href="css/theme/default.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<script>
			// If the query includes 'print-pdf' we'll use the PDF print sheet
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>
    <style type="text/css" media="screen">
      #body span.red * {
        color: #FF4000;
        xfont-weight: bold;
      }
      
      #body pre .comment {
        color: #1e1; 
      }
      
      #body section > h2 {
        margin-top: 0.3em;
      }
      
      #body section img {
        border: 0;
      }
    </style>
		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>
	
	<body id="body">
		
		<div class="reveal">

			<!-- Used to fade in a background when a specific slide state is reached -->
			<div class="state-background"></div>
			
			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

<section data-markdown>
##   What to expect…
<p>
  <img src="assets/smiling-at-camera-cat-expectation-vs-reality.jpg"></p>
</p>

</section>

<section data-markdown>
## Design by Contract

"...should define formal, precise and verifiable interface specifications, which extend … abstract data types with preconditions, postconditions and invariants."

[(en.wikipedia.org)](http://en.wikipedia.org/wiki/Design_by_contract)
</section>
<!-- Next slide ----------- -->
<section data-markdown>
## Example: Eiffel

"OO language and software contstruction environment, from 1986."

<pre><code>decrement is
    -- Decrease counter by one.
  require
    item &gt; 0
  do
    item := item - 1
  ensure
    item = old item - 1
  end 
</code></pre>
</section>
<!-- Next slide ----------- -->
<section data-markdown>
## Example: Eiffel (2)

<pre><code>decrement is
    -- Decrease counter by one.   # inline documentation
  require
    item &gt; 0                      # input contract
  do
    item := item - 1
  ensure
    item = old item - 1           # output contract
  end 
</code></pre>
</section>
<!-- Next slide ----------- -->
<section data-markdown>
## Example: C

<pre><code class="c">void process_short_string(const char* string) {
  assert(strlen(string) == 12);
  /* ... */
}

int main() {
  process_short_string("Hello world!\n");
}
</code></pre>

results in

<pre><code>~/tmp > ./hello 
Assertion failed: (strlen(string) == 12), function main, 
file hello.c, line 8.
Abort trap: 6
</code></pre>
</section>
<!-- Next slide ----------- -->
<section>
  <h2>Example: Rails</h2>
<pre style="font-size: 48%"><code># action_controller/metal/exceptions.rb

def send_file_headers!(options)
  type_provided = options.has_key?(:type)
  
  options.update(DEFAULT_SEND_FILE_OPTIONS.merge(options))
  [:type, :disposition].each do |arg|
    <span class="red">raise ArgumentError, ":#{arg} option required" if options[arg].nil?</span>
  end

  # ... do something
end
</code></pre>
</section>

<!-- Next slide ----------- -->
<section data-markdown>
<h2>&nbsp;</h2>
<h2>&nbsp;</h2>
## gem install expectation
</section>


<!-- Next slide ----------- -->
<section data-markdown>
## The expectation gem

<p style="height: 0.2em">  </p> 

- less code
- easy to remember syntax

<p style="height: 1em">  </p> 

<pre><code>def square(value) 
  expect! value => Integer
  value * value
end

square("12") # =>
# ArgumentError: '12' does not meet expectation Integer
</code></pre>

</section>

<!-- Next slide ----------- -->
<section data-markdown>
<h2>&nbsp;</h2>
<h3>Expectation examples</h3>

<pre><code># must be an Integer
expect! value => Integer   
  
# Integer or String
expect! value => [ Integer, String ]  

# Integer or String matching Regexp
expect! value => [ Integer, /^\d+$/ ] 

# Multiple expectations
expect! asked => String, got => 42, salt => /(K|Na)Cl$/
</code></pre>
</section>

<!-- Next slide ----------- -->
<section data-markdown>
<h2>&nbsp;</h2>
<h3>Expectation examples</h3>

<pre><code># Hash expectations
expect! foo => {
  :base_url  => /^(http|https):/,
  :amount    => 1..10,
  :objects   => [nil, Array]
}
</code></pre>
</section>

<!-- Next slide ----------- -->
<section data-markdown>
<h2>&nbsp;</h2>
<h3>Expectation examples</h3>

<pre><code class="ruby"># Special symbols
expect! foo => :truish

# block expectations
expect! {
  # Hmm, something complicated.
  validate_me(foo, bar)
}
</code></pre>
</section>

<!-- Next slide ----------- -->

<section data-markdown>
# Best practises
</section>

<!-- Next slide ----------- -->
<section>
<h3>Don't mix...</h3>
<p>
  ...input validation and algorithm.
</p>
<pre style="font-size: 45%"><code>def send_file_headers!(options)
  type_provided = options.has_key?(:type)
  
  options.update(DEFAULT_SEND_FILE_OPTIONS.merge(options))
  [:type, :disposition].each do |arg|
    <span class="red">raise ArgumentError, ":#{arg} option required" if options[arg].nil?</span>
  end

  # Do something...

  if content_type.is_a?(Symbol)
    extension = Mime[content_type]
    unless extension
    <span class="red">raise ArgumentError, "Unknown MIME type #{options[:type]}"</span>
    end
    self.content_type = extension
  else
    # Do something...
  end

  # Do something...
end
</code></pre>
</section>
<!-- Next slide ----------- -->
<section>
<h2>&nbsp;</h2>
<h3>Be rigid!</h3>
<pre style="font-size: 49%"><code>def send_file_headers!(options)
  type_provided = options.has_key?(:type)
  
  options.update(DEFAULT_SEND_FILE_OPTIONS.merge(options))
  [:type, :disposition].each do |arg|
    <span class="red">raise ArgumentError, ":#{arg} option required" if options[arg].nil?</span>
  end

  # Doesn't test disposition against "inline" or "attachment".
end
</code></pre>
</section>
<!-- Next slide ----------- -->
<section>
<h2>&nbsp;</h2>
<h3>Instead...</h3>
<pre><code>def send_file_headers!(options)
  expect! options => {
    :type => [ Symbol, String ], 
    :disposition => [ "inline", "attachment" ]
  }

  # Rest of code: input is valid.
end
</code></pre>
</section>

<!-- Next slide ----------- -->

<section data-markdown>
# Some examples
</section>

<!-- Next slide ----------- -->

<section>
<h2>&nbsp;</h2>
<p>
  Twitter screen names start with "@" in everyday use,
  but not in its API. So what to pass in here?
</p>
<pre><code># return node describing Twitter identity
def Twitter.identity(uid, screen_name = nil)
 expect! uid => [Integer, Neo4j::Node],
  screen_name => [/^[^@]/, nil]
  # ...
end
</code></pre>
</section>

<section>
<h2>&nbsp;</h2>
<p>Defensive programming: eat what you get!</p>
<pre><code># return node describing Twitter identity
def Twitter.identity(uid, screen_name = nil)
  screen_name.gsub!(/^@/, "") if screen_name
end
</code></pre>
</section>

<section>
<h2>&nbsp;</h2>
<p>Implicit documentation</p>
<pre style="font-size: 48%"><code># register a tweet.
def Twitter.register(tweet)
  expect! options => {
    :tweet_id     => Integer,         # The id of the tweet 
    :sender_id    => Integer,         # The twitter user id
    :sender_name  => [String, nil],   # The twitter user screen name
    :source_id    => [Integer, nil],  # The tweet's source user
    :source_name  => [String, nil],   # The tweet's source screen name
    :receiver_ids => [Array, nil],    # An array of receiver user ids
    :receiver_names => [Array, nil],  # An array of receiver user names
    :text         => String,          # The tweet text
    :lang         => String           # The tweet language
  }
end

</code></pre>
</section>

<section>
<h1>What to expect…</h1>
<p>…when you are expecting?</p>
</section>

<section>
<h2>Less runtime performance</h2>
<p>
  but some expectations can be disabled.
</p>
<pre style="font-size: 50%"><code>
# Object#expect! cannot be disabled, but Object#expect can
expect! arg => 1..5
expect arg => 1..5

# From now on Object#expect does nothing.
Expactation.disable if Rails.env.production?

# use blocks to avoid runtime overhead
expect {
  User.find(user_id)
}

</code></pre>
</section>

<section>
<h2>Less bugs during development.</h2>
<p><img src="assets/borat.jpg"></p>
<p>Higher development productivity.</p>
</section>

<section data-markdown>
## Credits & Links

- [reveal.js](https://github.com/hakimel/reveal.js) presentation script
- [expectation](https://github.com/radiospiel/expectation) at github.
- [radiospiel.org](https://radiospiel.org) blog.
- [@radiospiel](https://twitter.com/radiospiel)

<p style="height: 1.4em">  </p> 

<h3>Shameless self promotion</h3>
<p>
<img src="assets/kinopilot.png" style="border: 0; position: absolute; left: 0; margin-top: 0" width="96px">
</p>
<p style="margin-left: 104px;">
    <em>iPhone user and movie afficionado? Meet the Kinopilot Berlin app:
      <a href="http://bit.ly/kpilot">http://bit.ly/kpilot</a>.
</p>
</section>
</div>

			<!-- The navigational controls UI -->
			<aside class="controls">
				<a class="left" href="#">&#x25C4;</a>
				<a class="right" href="#">&#x25BA;</a>
				<a class="up" href="#">&#x25B2;</a>
				<a class="down" href="#">&#x25BC;</a>
			</aside>

			<!-- Presentation progress bar -->
			<div class="progress"><span></span></div>
			
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>
			
			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				
				theme: Reveal.getQueryHash().theme || 'default', // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/linear(2d)

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/highlight.js', async: true, callback: function() { window.hljs.initHighlightingOnLoad(); } },
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'lib/js/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'lib/js/data-markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '/socket.io/socket.io.js', async: true, condition: function() { return window.location.host === 'localhost:1947'; } },
					{ src: 'plugin/speakernotes/client.js', async: true, condition: function() { return window.location.host === 'localhost:1947'; } },
				]
			});
			
		</script>
	</body>
</html>
